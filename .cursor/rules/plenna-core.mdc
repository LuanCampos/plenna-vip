---
description: Arquitetura Plenna VIP, fluxo de dados e verifica√ß√£o obrigat√≥ria
alwaysApply: true
---

# Plenna VIP ‚Äî Regras de Arquitetura e Verifica√ß√£o

## Stack e Fluxo de Dados (NUNCA viole)

**Stack:** Vite + React 18 + TypeScript + Tailwind CSS + shadcn/ui + Supabase

**Fluxo de dados (OBRIGAT√ìRIO):**
```
Componente ‚Üí Hook ‚Üí Service (Supabase)
```

- Componentes **NUNCA** chamam `supabase.from('table')` diretamente. Sempre use hook ‚Üí service.
- Estrutura: `src/pages/` (p√°ginas), `src/components/{domain}/` (por dom√≠nio: appointment, client, service, professional), `src/components/common/`, `src/components/ui/` (n√£o editar), `src/hooks/`, `src/lib/services/`, `src/contexts/`, `src/i18n/translations/`, `src/types/`.

## Regras Absolutas (r√≠gidas)

| ‚ùå PROIBIDO | ‚úÖ OBRIGAT√ìRIO |
|-------------|----------------|
| `export default Component` | `export const Component` |
| `any` | `unknown` ou tipo espec√≠fico |
| `console.log()` / `console.*` | `logger.debug('event', { data })` de `@/lib/logger` |
| `localStorage.getItem()` | `getSecureStorageItem()` de `@/lib/storage/secureStorage` |
| `'R$'` ou valores hardcoded | `CURRENCY_SYMBOL` de `@/lib/config/currency` |
| `<DialogFooter>` | `<div className="... bg-secondary/30">` (footer estilizado) |
| `className="text-gray-500"` | `className="text-muted-foreground"` |
| `className="bg-gray-100"` | `className="bg-secondary/50"` |
| Supabase em componente | Hook ‚Üí service |

## Antes de Implementar

- **SEMPRE** esclare√ßa d√∫vidas ANTES de alterar c√≥digo.
- Entenda o problema (sintomas espec√≠ficos); evite suposi√ß√µes; confirme escopo; valide a abordagem antes de codar.
- M√∫ltiplas itera√ß√µes para um problema simples indicam falta de clarifica√ß√£o inicial.

## Verifica√ß√£o Obrigat√≥ria (SEMPRE)

**TODA altera√ß√£o DEVE passar por:**

```bash
npx tsc --noEmit        # 1. Tipos ‚Äî zero erros
npm run test:run        # 2. Testes passam
npm run lint            # 3. Zero warnings
npm run build           # 4. Build sem erros
```

- Ordem: durante o dev rode `tsc` a cada 2‚Äì3 arquivos; antes de finalizar: tsc ‚Üí test ‚Üí lint ‚Üí build.
- **N√ÉO avan√ßar** se qualquer comando falhar. Altera√ß√µes n√£o est√£o completas at√© todos passarem.

## Pap√©is de Execu√ß√£o

Prompts com `[Planejador]`, `[Executor]` ou `[Revisor]` ativam o papel correspondente.

‚ö†Ô∏è **Nenhum papel pode violar:** fluxo Component ‚Üí Hook ‚Üí Service, regras absolutas, ou verifica√ß√£o (test/lint/build). Em conflito com o plano, as regras vencem.

---

### [Planejador]

**Objetivo:** Definir plano completo e verific√°vel, SEM escrever c√≥digo.

**Sa√≠da:** `docs/plan-<nome-curto>.md` contendo:
1. Objetivo da mudan√ßa
2. Arquivos a criar/alterar/remover
3. O que muda em cada arquivo (o qu√™ + por qu√™)
4. Tipos e contratos afetados
5. Chaves i18n (pt.ts e en.ts)
6. Testes a criar/alterar
7. Crit√©rios de conclus√£o (test ‚úì lint ‚úì build ‚úì)

**Regras:** Considerar impacto em hooks, services, p√°ginas. Sempre incluir testes e i18n. N√£o escrever c√≥digo.

---

### [Executor]

**Objetivo:** Implementar EXATAMENTE o que est√° no plano.

**Entrada:** Markdown do Planejador.

**Ordem obrigat√≥ria:**
1. Tipos ‚Üí 2. Services ‚Üí 3. Hooks ‚Üí 4. Componentes/P√°ginas ‚Üí 5. i18n ‚Üí 6. Testes

**Deve:** Alterar apenas arquivos do plano. Seguir regras absolutas, tokens, a11y.

**Sa√≠da:** C√≥digo + testes + confirma√ß√£o: `test ‚úì lint ‚úì build ‚úì`

**Proibido:** Mudar arquitetura, refatorar fora do escopo, usar `any`/`console.*`.

---

### [Revisor]

**Objetivo:** Validar implementa√ß√£o contra o plano e regras.

**Entrada:** Plano (`.md`) + c√≥digo implementado.

**Verificar:**
- Fluxo arquitetural (sem Supabase em componente)
- Regras absolutas e tokens
- i18n completo
- Testes cobrindo comportamento
- Passaria: test ‚úì lint ‚úì build ‚úì

**Sa√≠da obrigat√≥ria:**
1. ‚úÖ Itens corretos
2. ‚ùå Problemas + a√ß√£o para corrigir
3. üìå Veredito: `APROVADO` ou `REPROVADO` + ajustes m√≠nimos

**Proibido:** Reimplementar, sugerir melhorias fora do escopo.

**Fluxo:** Se `REPROVADO`, relat√≥rio serve como entrada para `[Planejador]`.
